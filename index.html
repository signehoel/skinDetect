<!-- Welcome to some sample code to control your Firebase Database -->
<!-- HERE IS YOUR HTML TO SET UP YOUR PAGE -->
<html>
    <head>
        <!-- HERE ARE YOUR FIREBASE and GOOGLE AUTHENICATION IMPORTS -->
        <script src="https://www.gstatic.com/firebasejs/5.7.3/firebase.js"></script>
        <script src="https://apis.google.com/js/platform.js" async defer></script>
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link rel="stylesheet" href="main.css">

        <!-- Compiled and minified JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        
    </head>
    <body >
        <nav>
            <div class="nav-wrapper">
              <a href="#!" class="brand-logo" style="padding-left:1%"><img src="skindetect.png"></a>
              <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
              <ul class="right hide-on-med-and-down">
                <li><a href="sass.html">DevPost</a></li>
                <li><a href="https://github.com/signehoel/skinDetect">GitHub</a></li>
              </ul>
            </div>
        </nav>
        
          <ul class="sidenav" id="mobile-demo">
            <li><a href="sass.html">Sass</a></li>
            <li><a href="badges.html">Components</a></li>
            <li><a href="collapsible.html">Javascript</a></li>
            <li><a href="mobile.html">Mobile</a></li>
          </ul>

          <div class="hero-image">
            <div class="hero-text">
              <h1>Welcome to SkinDetect!</h1>
              <p>Ensure your health in a matter of seconds.</p>
              <a class='btn' href='upload.html'>Get Started</a>
            </div>
          </div>
          <div class="container" style="margin-top:25px">
            <!-- Page Content goes here -->
            
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin porttitor, enim ut euismod maximus, dui dolor vehicula ipsum, congue pellentesque neque purus in orci. In hac habitasse platea dictumst. Nulla facilisi. Sed ipsum est, dignissim ac tempus sit amet, sodales non massa. Nulla blandit magna in magna posuere, vel mollis erat mollis. Donec non ornare quam, eu molestie sapien. Donec aliquet libero elit, quis rutrum massa tincidunt ut. Suspendisse vitae sagittis eros. Praesent ullamcorper dui dictum tellus dictum eleifend. Donec tincidunt nisl id gravida mattis.</p>
            
            <p>Nunc facilisis tincidunt nulla in commodo. Maecenas interdum ligula volutpat fringilla porta. Vivamus condimentum neque sed nibh porttitor, sed pharetra purus ultricies. Duis sed mi eget elit semper scelerisque. Maecenas tempus luctus velit vel facilisis. Fusce ut turpis dictum, venenatis dui ac, finibus nunc. Sed lacinia sed justo quis sagittis. Sed ut placerat arcu. Maecenas finibus tristique nulla id imperdiet. Aliquam erat volutpat. Morbi porttitor lacus velit, a cursus lorem viverra id. Etiam sodales hendrerit molestie. Proin vel erat bibendum, venenatis nisi non, placerat quam. Quisque ac vulputate turpis.</p>     
            
            <p>Ut sed commodo augue. Phasellus auctor leo quis viverra convallis. Sed et molestie metus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Donec ut dui vel purus consectetur tempus. Duis tristique sapien a turpis feugiat, a eleifend libero bibendum. Etiam sagittis orci odio, eu tempor massa dignissim sit amet. Sed porttitor ex ac semper viverra. Sed pretium ante nec ligula dapibus auctor. Suspendisse vulputate lectus ut quam viverra, in mollis magna lacinia. Cras eget tempor ligula. Sed sit amet placerat risus. Cras finibus est a posuere vulputate.</p>
          
            
            <!--
            <button class='btn' onclick="signin()">Sign in</button>
            <button class='btn' onclick="getData()">Get data</button>
            <button class='btn' onclick="setData()">Set data</button>
            <button class='btn' onclick="updateData()">Update data</button>
            <button class='btn' onclick="pushData()">Push data</button>
            <button class='btn' onclick="removeData()">Remove data</button>
            <div id="info"></div> -->
            <div class="row">
                <div class="col s12 m6">
                  <div class="card">
                    <div class="card-content">
                      <span class="card-title">Upload File</span>
                      <form>
                        <div class="file-field input-field">
                            <div class="btn">
                                <span>Select File</span>
                                <input type="file" class="file-select " accept="image/*"/> <!--asking to upload image-->
                            </div>
                            <div class="file-path-wrapper">
                                <input class="file-path validate" type="text">
                            </div>
                            <div id="filesubmit">    
                                <button class="file-submit btn waves-effect waves-light">SUBMIT
                                </button>
                            </div>
                        </div>
                      </form>    
                    </div>
                  </div>
                </div>
            </div>

            <div class="row">
                <div class="col s6">
                    <h2>Upload File</h2>
                    <form action="#">
                        <div class="file-field input-field">
                            <div class="btn">
                                <span>Select File</span>
                                <input type="file" class="file-select " accept="image/*"/> <!--asking to upload image-->
                            </div>
                            <div class="file-path-wrapper">
                                <input class="file-path validate" type="text">
                            </div>
                            <div id="filesubmit">    
                                <button class="file-submit btn">SUBMIT</button>
                            </div>
                        </div>   
                    </form>
                </div>
            </div>
            <div id="uid"></div>
        </div>
    </body>

    <script>

    // HERE IS THE JAVASCRIPT TO CONNECT TO YOUR FIREBASE
    
        // Your web app's Firebase configuration
        var config = {
            apiKey: "AIzaSyD0FjPIZoXNXzUsImWttXhLiL0DTqhzNgE",
            authDomain: "skin-lesion-classifier-8affe.firebaseapp.com",
            databaseURL: "https://skin-lesion-classifier-8affe.firebaseio.com",
            projectId: "skin-lesion-classifier-8affe",
            storageBucket: "skin-lesion-classifier-8affe.appspot.com",
            messagingSenderId: "877188134640",
            appId: "1:877188134640:web:06b3996e1db00c59613435",
            measurementId: "G-3Y4GEZ104Q"
          };
        firebase.initializeApp(config);
        //IMAGE UPLOAD
    const storageService = firebase.storage();
    const storageRef = storageService.ref();
    document.querySelector('.file-select').addEventListener('change', handleFileUploadChange);

    document.querySelector('.file-submit').addEventListener('click', handleFileUploadSubmit);

    let selectedFile;

    function handleFileUploadChange(e) {
        selectedFile = e.target.files[0];
    }

    function handleFileUploadSubmit(e) {
        const uploadTask = storageRef.child(`images/${selectedFile.name}`).put(selectedFile); //create a child directory called images, and place the file inside this directory
        uploadTask.on('state_changed', (snapshot) => {
        // Observe state change events such as progress, pause, and resume
        }, (error) => {
            // Handle unsuccessful uploads
            console.log(error);
        }, () => {
            // Do something once upload is complete
            console.log('success');
        });
    }
           
    // Check to see if you are logged in
    firebase.auth().onAuthStateChanged(function(user) {
        if (user == null) {
            document.getElementById("uid").innerHTML = "not logged in";
            return;
        } else {
            userId = user.uid; // you can also get .displayName, .photoURL, .email
            //document.getElementById("uid").innerHTML = userId; // display Google uid on page
            
        } // end user null check
    }); // end check auth state
               
        // Check to see if you are logged in
        firebase.auth().onAuthStateChanged(function(user) {
            if (user == null) {
                document.getElementById("uid").innerHTML = "not logged in";
                return;
            } else {
                userId = user.uid; // you can also get .displayName, .photoURL, .email
                document.getElementById("uid").innerHTML = userId; // display Google uid on page
                
            } // end user null check
        }); // end check auth state
        
       // HERE IS THE FUNCTION TO SHOW HOW TO GET USER DATA
       function getData() {
           var userId = document.getElementById("uid").innerHTML;
           firebase.database().ref('/tweets/' + userId).once('value', function(snapshot) {
               console.log(snapshot.val());
           });

       }
       
       // HERE IS THE FUNCTION TO SHOW HOW TO SET/OVERWRITE USER DATA
       function setData() {
           var userId = document.getElementById("uid").innerHTML;
           var js_time = Date.now();
           firebase.database().ref('/tweets/' + userId).set({tweet:"Set over-writes", time: js_time}); 
       }
        
       // HERE IS THE FUNCTION TO SHOW HOW TO SET/OVERWRITE USER DATA
       function updateData() {
           var userId = document.getElementById("uid").innerHTML;
           firebase.database().ref('/tweets/' + userId).update({tweet:"Update replaces data, but will leave non replaced data as is"}); 
       }
         
        // HERE IS THE FUNCTION TO SHOW HOW TO PUSH/ADD NEW USER DATA TO EXISTING DATABASE
        function pushData() {
            var userId = document.getElementById("uid").innerHTML;
            var js_time = Date.now();
            var tweetid = firebase.database().ref('tweets/' + userId + "/").push({tweet: "push adds to the nodes, a unique key/timestamp is also added", time: js_time});
        }

        // HERE IS THE FUNCTION TO SHOW HOW TO REMOVE USER DATA FROM EXISTING DATABASE - BE CAREFUL!
        function removeData() {
            var tweetid = firebase.database().ref('tweets/' + userId + "/").remove();
        }
        
        function signin() {
            var provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithRedirect(provider).then(function(result) { 
                window.location.replace("fbtest.html");
            });
        }
    </script>
</html>
